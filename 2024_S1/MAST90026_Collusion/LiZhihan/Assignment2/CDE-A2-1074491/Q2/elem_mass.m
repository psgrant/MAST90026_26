% To computes the mass matrix M for a triangular element
function M = elem_mass(P1, P2, P3, q, quad_order)
j11=P2(1)-P1(1); % Setup and Initial Calculations
j12=P3(1)-P1(1);
j21=P2(2)-P1(2);
j22=P3(2)-P1(2);
detJ=(j11*j22-j12*j21);
K=abs(detJ);
mass=zeros(3,3); % Matrix Initialization
    if (quad_order == 1) % oder1
        mass(1,1)=q((P1(1)+P2(1)+P3(1))/3,(P1(2)+P2(2)+P3(2))/3)/9;
        mass(1,2)=q((P1(1)+P2(1)+P3(1))/3,(P1(2)+P2(2)+P3(2))/3)/9;
        mass(1,3)=q((P1(1)+P2(1)+P3(1))/3,(P1(2)+P2(2)+P3(2))/3)/9;
        mass(2,1)=q((P1(1)+P2(1)+P3(1))/3,(P1(2)+P2(2)+P3(2))/3)/9;
        mass(2,2)=q((P1(1)+P2(1)+P3(1))/3,(P1(2)+P2(2)+P3(2))/3)/9;
        mass(2,3)=q((P1(1)+P2(1)+P3(1))/3,(P1(2)+P2(2)+P3(2))/3)/9;
        mass(3,1)=q((P1(1)+P2(1)+P3(1))/3,(P1(2)+P2(2)+P3(2))/3)/9;
        mass(3,2)=q((P1(1)+P2(1)+P3(1))/3,(P1(2)+P2(2)+P3(2))/3)/9;
        mass(3,3)=q((P1(1)+P2(1)+P3(1))/3,(P1(2)+P2(2)+P3(2))/3)/9;
        mass=mass*K/2;
        M=mass;
    else % oder 2
        mass(1,1)=q((P1(1)+P2(1))/2,(P1(2)+P2(2))/2)/4+q((P1(1)+P3(1))/2,(P1(2)+P3(2))/2)/4;
        mass(1,2)=q((P1(1)+P2(1))/2,(P1(2)+P2(2))/2)/4;
        mass(1,3)=q((P1(1)+P3(1))/2,(P1(2)+P3(2))/2)/4;
        mass(2,1)=q((P1(1)+P2(1))/2,(P1(2)+P2(2))/2)/4;
        mass(2,2)=q((P1(1)+P2(1))/2,(P1(2)+P2(2))/2)/4+q((P2(1)+P3(1))/2,(P2(2)+P3(2))/2)/4;
        mass(2,3)=q((P2(1)+P3(1))/2,(P2(2)+P3(2))/2)/4;
        mass(3,1)=q((P1(1)+P3(1))/2,(P1(2)+P3(2))/2)/4;
        mass(3,2)=q((P2(1)+P3(1))/2,(P2(2)+P3(2))/2)/4;
        mass(3,3)=q((P1(1)+P3(1))/2,(P1(2)+P3(2))/2)/4+q((P2(1)+P3(1))/2,(P2(2)+P3(2))/2)/4;
        mass=mass*K/6;
        M=mass;    
    end
end